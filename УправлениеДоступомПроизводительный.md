# Настройкика производительного механизма ограничения прав на уровне записи

1. В общем модуле **УправлениеДоступомПереопределяемый**  
в процедуру **ПриЗаполненииСписковСОграничениемДоступа**  
дописать объекты, которые будут использовать новый механизм проверки ограничений на уровне записей.

2. В модуле менеджера каждого из объектов,  
который был описан в предыдущем шаге,  
добавить функцию **ПриЗаполненииОграниченийДоступа**,  
в которой на специальном языке описания ограничений указать какие виды доступа необходимо проверить.

    *Подробное описание языка ограничений есть на ИТС,  
    а также синтаксис языка ограничений находится в модуле  
    **УправлениеДоступомСлужебный** в функции  
    **СинтаксисЯзыка.***

3. В форме элемента объекта в процеруду **ПриЧтенииНаСервере**  
дописать

        УправлениеДоступом.ПриЧтенииНаСервере(ЭтотОбъект, ТекущийОбъект);
    
    В процедуру обработчика события **ПослеЗаписиНаСервере** необходимо вставить вызов:
    
        УправлениеДоступом.ПослеЗаписиНаСервере(ЭтотОбъект, ТекущийОбъект, ПараметрыЗаписи);

4. В определяемых типах
    
    **ВладелецЗначенийКлючейДоступа** (СправочникСсылка, ДокументСсылка, ЗадачаСсылка, ПланВидовХарактеристикСсылка, )
    **ВладелецЗначенийКлючейДоступаДокумент** (ДокументОбъект),  
    **ВладелецЗначенийКлючейДоступаНаборЗаписей** (РегистрСведенийНаборЗаписей, РегистрНакопленияНаборЗаписей),  
    **ВладелецЗначенийКлючейДоступаОбъект** (СправочникОбъект, БизнесПроцессОбъект, ЗадачаОбъект)

    добавить вышеописанные объекты / наборы записей регистров.

    Если объект используется как значение группы доступа, то использовать типы:
    **ЗначениеДоступа**
    **ЗначениеДоступаОбъект**


5. Для регистров сведений или накопления необходимо в справочнике Идентификаторы объектов метаданных
добавить предопределенные элементы в соответствии с уже существующими.


6. Вставка ограничений в права ролей


---

## Примечания

Следует иметь в виду, что ограничения доступа к документу в виде  
    
    ЗначениеРазрешено(Организация)

и в виде  
    
    ЧтениеОбъектаРазрешено(Организация)

являются разными.

**В первом случае проверяется разрешенность значения в группах доступа с правами на документ,**  
а во втором случае проверяется,  
**что группа доступа с правами на документ предоставляет право Чтение на проверяемую организацию**

---

## Копирование шаблонов ограничения доступа при разработке
Чтобы добавить новое ограничение с использованием шаблона требуется скопировать шаблон из роли

    ИзменениеУчастниковГруппДоступа

в свою роль.
